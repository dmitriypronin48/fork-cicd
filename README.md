# Домашнее задание к занятию 1 «Disaster recovery и Keepalived» - `Пронин Дмитрий Андреевич`

---

### Задание 1

```Задание 1
Запустите два simple python сервера на своей виртуальной машине на разных портах
Установите и настройте HAProxy, воспользуйтесь материалами к лекции по ссылке
Настройте балансировку Round-robin на 4 уровне.
На проверку направьте конфигурационный файл haproxy, скриншоты, где видно перенаправление запросов на разные серверы при обращении к HAProxy.```





---

### Задание 2








```
Запустите две виртуальные машины Linux, установите и настройте сервис Keepalived как в лекции, используя пример конфигурационного файла.

Настройте любой веб-сервер (например, nginx или simple python server) на двух виртуальных машинах

Напишите Bash-скрипт, который будет проверять доступность порта данного веб-сервера и существование файла index.html в root-директории данного веб-сервера.

Настройте Keepalived так, чтобы он запускал данный скрипт каждые 3 секунды и переносил виртуальный IP на другой сервер, если bash-скрипт завершался с кодом, отличным от нуля (то есть порт веб-сервера был недоступен или отсутствовал index.html). Используйте для этого секцию vrrp_script

На проверку отправьте получившейся bash-скрипт и конфигурационный файл keepalived, а также скриншот с демонстрацией переезда плавающего ip на другой сервер в случае недоступности порта или файла index.html
```
## Скрипт, который проверяет доступность порта, а так же конфига
![скрипт](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-2.jpg)

## Конфиг nginx. К нему прикручены сертификаты, а так же прикрутил тестовый домен. 
![](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-3.jpg)

Для nginx сделана index.html одинаковая, отличаются только IP. Сделал так, чтобы наглядно было понятно для себя, работает ли переключение или нет.

## конфиг keepalived для мастер машины
![keepalived master](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-4.jpg)

## конфиг keepalived для бэкап машины
![keepalived backup](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-5.jpg)

## Заходим по vip адресу на домен и попадаем на один из nginx, в нашем случае - это Мастер
![проверка](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-6.jpg)

## Стопнул nginx. Проверить переключение
![проверка2](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-7.jpg)

## Проверка переключения
![проверка3](https://github.com/dmitriypronin48/fork-cicd/blob/main/img/z1-8.jpg)

Для проверки работы скрипта, сделал простое переименование стартовой страницы index.html, скрипт в течении трех секунд проехался, понял, что чего то не хватает и выполнилось переключение на бэкап тачку.







